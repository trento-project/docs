include::product-attributes.adoc[]

[[sec-trento-mcp-config]]
=== Configure {tr_mcp}
:revdate: 2025-11-24

This section provides an overview of how to configure the {tr_mcp} depending on the deployment method.

* <<sec-trento-mcp-kubernetes-config,Configuration in a {k8s} deployment>>
* <<sec-trento-mcp-systemd-config,Configuration in systemd RPM deployment>>

[[sec-trento-mcp-kubernetes-config]]
==== Configuration in a {k8s} deployment

===== Configuration Sources

The {tr_mcp} supports multiple configuration sources with the following priority order (highest to lowest):

1. **Environment variables** - Used for containerized deployments.
2. **Built-in defaults** - Fallback values.

[[sec-trento-mcp-kubernetes-config-sources]]
===== Configuration Overview

[width="100%",options="header"]
|===
|Environment Variable |Default Value |Description

|`TRENTO_MCP_AUTODISCOVERY_PATHS`
|`/api/all/openapi,/wanda/api/all/openapi`
|Custom paths for API autodiscovery.

|`TRENTO_MCP_ENABLE_HEALTH_CHECK`
|`false`
|Enable the health check server.

|`TRENTO_MCP_CONFIG`
|(empty)
|Configuration file path.

|`TRENTO_MCP_HEADER_NAME`
|`Authorization`
|Header name used to pass the {trento} API key to the {tr_mcp}.

|`TRENTO_MCP_HEALTH_API_PATH`
|`{tr_mcp_health_api_path}`
|API path used for health checks on target servers.

|`TRENTO_MCP_HEALTH_PORT`
|`{tr_mcp_health_port}`
|Port where the health check server runs.

|`TRENTO_MCP_INSECURE_SKIP_TLS_VERIFY`
|`false`
|Skip TLS certificate verification when fetching OAS specs from HTTPS.

|`TRENTO_MCP_OAS_PATH`
|`[]`
|Path(s) to OpenAPI specification file(s). Can be set multiple times.

|`TRENTO_MCP_PORT`
|`{tr_mcp_default_port}`
|Port where the {tr_mcp} runs.

|`TRENTO_MCP_TAG_FILTER`
|`["MCP"]`
|Only include operations that contain one of these tags.

|`TRENTO_MCP_TRANSPORT`
|`streamable`
|Protocol to use: `streamable` or `sse`.

|`TRENTO_MCP_TRENTO_URL`
|(empty)
|Target {trento} server URL. Required for autodiscovery if OAS path is not set.

|`TRENTO_MCP_VERBOSITY`
|`info`
|Log level: `debug`, `info`, `warning`, or `error`.
|===

===== {k8s} Deployment Example

[source,yaml,subs="attributes"]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {tr_mcp_binary}
spec:
  template:
    spec:
      containers:
      - name: {tr_mcp_binary}
        image: {tr_mcp_binary}:latest
        env:
        - name: TRENTO_MCP_PORT
          value: "{tr_mcp_default_port}"
        - name: TRENTO_MCP_HEALTH_PORT
          value: "{tr_mcp_health_port}"
        - name: TRENTO_MCP_ENABLE_HEALTH_CHECK
          value: "true"
        - name: TRENTO_MCP_TRENTO_URL
          value: "{tr_server_url_https}"
        - name: TRENTO_MCP_VERBOSITY
          value: "info"
        ports:
        - containerPort: {tr_mcp_default_port}
          name: mcp
        - containerPort: {tr_mcp_health_port}
          name: health
----

[[sec-trento-mcp-systemd-config]]
==== Systemd Deployment

[[sec-trento-mcp-systemd-config-sources]]
===== Configuration Sources

The {tr_mcp} supports multiple configuration sources with the following priority order (highest to lowest):

1. **Command-line flags** - Override config for the current process.
2. **Configuration file** - Persistent settings configuration.

===== Configuration Overview

The `{tr_mcp_binary}` binary accepts several command-line flags to configure its behavior. The following table lists all available configuration options, their corresponding flags, configuration variables, and default values.

[width="100%",options="header"]
|===
|Flag| Config Variable |Default Value |Description

|`--autodiscovery-paths, -A`
|`AUTODISCOVERY_PATHS`
|`/api/all/openapi,/wanda/api/all/openapi`
|Custom paths for API autodiscovery.

|`--config, -c`
|(empty)
|(empty)
|Configuration file path.

|`--enable-health-check, -d`
|`ENABLE_HEALTH_CHECK`
|`false`
|Enable the health check server.

|`--header-name, -H`
|`HEADER_NAME`
|`Authorization`
|Header name used to pass the {trento} API key to the {tr_mcp}.

|`--health-api-path, -a`
|`HEALTH_API_PATH`
|`{tr_mcp_health_api_path}`
|API path used for health checks on target servers.

|`--health-port, -z`
|`HEALTH_PORT`
|`{tr_mcp_health_port}`
|Port where the health check server runs.

|`--insecure-skip-tls-verify, -i`
|`INSECURE_SKIP_TLS_VERIFY`
|`false`
|Skip TLS certificate verification when fetching OAS specs from HTTPS.

|`--oas-path, -P`
|`OAS_PATH`
|`[]`
|Path(s) to OpenAPI specification file(s). Can be set multiple times.

|`--port, -p`
|`PORT`
|`{tr_mcp_default_port}`
|Port where the {tr_mcp} runs.

|`--tag-filter, -f`
|`TAG_FILTER`
|`["MCP"]`
|Only include operations that contain one of these tags.

|`--transport, -t`
|`TRANSPORT`
|`streamable`
|Protocol to use: `streamable` or `sse`.

|`--trento-url, -u`
|`TRENTO_URL`
|(empty)
|Target {trento} server URL. Required for autodiscovery if OAS path is not set.

|`--verbosity, -v`
|`VERBOSITY`
|`info`
|Log level: `debug`, `info`, `warning`, or `error`.
|===

===== Configure {tr_mcp} with Command-Line Flags

{tr_mcp} allows you to override configuration settings using command-line flags for temporary changes. These overrides are not persistent and are lost when the process stops or the system is rebooted. To make configuration changes permanent for the systemd service, update `{tr_mcp_config_file}` and restart the service.

[para]
Basic usage with custom port, verbosity, and target URL:
[source,console,subs="attributes"]
----
{tr_mcp_binary} --port 9000 --verbosity debug --trento-url {tr_server_url_https}
----

[para]
Using multiple OpenAPI specifications:
[source,console,subs="attributes"]
----
{tr_mcp_binary} --oas-path https://api1.example.com/openapi.json --oas-path https://api2.example.com/openapi.json
----

[para]
Autodiscovery with custom paths:
[source,console,subs="attributes"]
----
{tr_mcp_binary} --trento-url {tr_server_url_https} --autodiscovery-paths /api/v1/openapi,/wanda/api/v1/openapi
----

[para]
Enable health checks on a custom port:
[source,console,subs="attributes"]
----
{tr_mcp_binary} --enable-health-check --health-port {tr_mcp_health_port} --port {tr_mcp_default_port}
----

[[sec-trento-mcp-help-validation]]
===== Help and Validation

You can see all available flags by running:

[source,console,subs="attributes"]
----
{tr_mcp_binary} --help
----

The server will validate the configuration on startup and log any issues with debug verbosity enabled.

[[sec-trento-mcp-health-checks]]
==== Health Check Configuration systemd deployment

The {tr_mcp} includes built-in health check endpoints for systemd and {k8s} integration.

[NOTE]
====
Health check functionality is disabled by default and must be explicitly enabled using the `--enable-health-check` flag or the `TRENTO_MCP_ENABLE_HEALTH_CHECK` environment variable.
====

===== Health Check Endpoints

The health check server provides the following endpoints:

* `/livez` - Liveness probe for {k8s} pod restart decisions.
* `/readyz` - Readiness probe for traffic routing decisions.

The readiness endpoint performs comprehensive health checks, including:

* `mcp-server` - Validates {tr_mcp} connectivity using an MCP client.
* `api-server` - Verifies connectivity to the configured {trento} API server.

===== Enable Health Checks with the command-line for systemd deployment

[source,console,subs="attributes"]
----
{tr_mcp_binary} --enable-health-check
----

[source,console,subs="attributes"]
----
{tr_mcp_binary} --enable-health-check --health-port {tr_mcp_health_port}
----

====== Testing Health Endpoints

[source,console,subs="attributes"]
----
# Test liveness endpoint
curl http://localhost:{tr_mcp_health_port}/livez

# Test readiness endpoint
curl http://localhost:{tr_mcp_health_port}/readyz

# Expected readiness response format:
# {"status":"up","checks":{"mcp-server":{"status":"up"},"api-server":{"status":"up"},"api-documentation":{"status":"up"}}}

# Expected liveness response format:
# {"status":"up"}
----

[[sec-trento-mcp-troubleshooting]]
==== Troubleshooting

This section provides solutions for common issues when deploying and using the {tr_mcp}.

===== Connection Issues

* **{tr_mcp} cannot connect to {trento} API**
** Verify the `TRENTO_URL` or `OAS_PATH` configuration points to accessible endpoints
** Check network connectivity between the {tr_mcp} and {trento} components
** Ensure API authentication is properly configured with valid tokens

* **MCP clients cannot connect to {tr_mcp}**
** Verify the {tr_mcp} is running and listening on the correct port (default: {tr_mcp_default_port})
** Check firewall rules allow access to the {tr_mcp} port
** Ensure the {tr_mcp} endpoint URL is correctly configured in client applications

===== Authentication Issues

* **API token authentication fails**
** Verify the Personal Access Token is valid and not expired
** Ensure the token has the necessary permissions in {trento}
** Check that the `HEADER_NAME` configuration matches between server and client

* **Token not accepted**
** Confirm the token was generated from the correct {trento} instance
** Verify the token format and ensure it includes the "Bearer " prefix if required

===== Configuration Issues

* **OpenAPI specification not found**
** Check that `TRENTO_URL` or `OAS_PATH` point to valid {trento} API endpoints
** Verify the {tr_web} and {tr_wanda} services are running and accessible
** Ensure autodiscovery paths are correct if using `TRENTO_URL`

* **Tools not appearing in MCP clients**
** Check the `TAG_FILTER` configuration - only operations with matching tags are exposed
** Verify the OpenAPI specifications are accessible and valid
** Ensure the {tr_mcp} can parse the API documentation

===== Performance Issues

* **Slow response times**
** Check network latency between {tr_mcp} and {trento} components
** Review {trento} API performance and database query times
** Consider enabling debug logging to identify bottlenecks

* **High resource usage**
** Monitor {tr_mcp} memory and CPU usage
** Check for memory leaks in long-running processes
** Consider adjusting logging verbosity to reduce I/O overhead

===== Health Check Issues

* **Health checks failing**
** Verify health check endpoints are accessible
** Check that all required services ({trento} API, {tr_mcp}) are responding
** Review health check configuration and timeouts

===== Logging and Debugging

* **Enable debug logging**
** Set `VERBOSITY=debug` to get detailed logs
** Check {tr_mcp} logs for error messages and connection attempts
** Review {trento} component logs for API-related issues

* **Common log messages**
** "Failed to fetch OpenAPI specification" - Check API endpoint accessibility
** "Authentication failed" - Verify API token configuration
** "No tools available" - Check tag filtering and API documentation

===== Getting Help

If you continue to experience issues:

. Check the {tr_mcp} logs for detailed error messages
. Verify all configuration values using `{tr_mcp_binary} --help`
. Test API connectivity directly using curl or similar tools
. Check the {trento} server logs for API authentication and access issues
