include::product-attributes.adoc[]

[[sec-trento-mcp-server-systemd]]
==== systemd {tr_mcp} deployment

A systemd-based installation of the {tr_mcp} using RPM packages can be performed manually on the latest supported versions of {sles4sap}, from 15 SP4 up to 16.0. For installations on service packs other than the current one, make sure to update the repository URL as described in the relevant notes throughout this guide.

include::partials/supported-versions.adoc[]

===== Installing {tr_mcp} using RPM packages

. Install the MCP Server package:
+
[source,bash]
----
zypper install mcp-server-trento
----

. Create the {tr_mcp} configuration file at `/etc/trento/mcp-server-trento`:
+
[source,bash]
----
cp /etc/trento/mcp-server-trento.example /etc/trento/mcp-server-trento
----

. Edit the configuration file to point to your {trserver}:
+
[source,bash]
----
vim /etc/trento/mcp-server-trento
----
+
Configure the connection to your {trserver}. There are two approaches:
+
**When to use `TRENTO_URL`**:
+
* Trento Server is deployed behind a reverse proxy (NGINX, etc.).
* MCP Server runs on a different host/network than Trento.
* You want to use external/public URLs.
+
**When to use `OAS_PATH`**:
+
* MCP Server runs on the same host as Trento components.
* You want to connect directly to internal services.
* You need to bypass reverse proxy configurations.
+
The `TRENTO_URL` approach is recommended for most production deployments.
+
Example `TRENTO_URL`:
+
[source,env]
----
TRENTO_URL=https://trento.example.com
PORT=5000
----
+
Example `OAS_PATH`:
+
[source,env]
----
OAS_PATH=http://localhost:4000/api/all/openapi,http://localhost:4001/wanda/api/all/openapi
PORT=5000
----
+
[NOTE]
====
The MCP Server's health check HTTP server is primarily intended for Kubernetes environments, where liveness/readiness probes use it. Outside Kubernetes, you can leave it disabled. If you choose to enable it, set `ENABLE_HEALTH_CHECK=true` and `HEALTH_PORT=8080` and ensure the port is accessible.
====

. Enable and start the MCP Server service:
+
[source,bash]
----
systemctl enable --now mcp-server-trento
systemctl start mcp-server-trento
----

. Verify the service is running:
+
[source,bash]
----
systemctl status mcp-server-trento
----
+
Expected output:
+
[source,bash]
----
‚óè mcp-server-trento.service - Trento MCP Server service
     Loaded: loaded (/usr/lib/systemd/system/mcp-server-trento.service; enabled)
     Active: active (running) since ...
----

. Check the service logs:
+
[source,bash]
----
journalctl -u mcp-server-trento -f
----

. The Trento MCP Server should be listening at `http://localhost:5000/mcp`.
If firewalld is running, allow {tr_mcp} to be accessible and add an exception to firewalld:
+
[source,bash]
----
firewall-cmd --zone=public --add-port=5000/tcp --permanent
firewall-cmd --reload
----

. If you enabled health checks, verify the endpoints locally:
+
[source,bash]
----
# Note: Replace localhost with the server's IP/hostname if running these commands from a remote machine, and ensure the health port is allowed by your firewall.

# Liveness endpoint:
curl http://localhost:8080/livez

# Example output:
# {"info":{"name":"trento-mcp-server","version":"0.1.0"},"status":"up"}

# Readiness endpoint:
curl http://localhost:8080/readyz

# Example output:
# {"status":"up","details":{"mcp-server":{"status":"up","timestamp":"2025-10-09T12:11:09.528898849Z"},"wanda-api":{"status":"up","timestamp":"2025-10-09T12:11:09.542078327Z"},"web-api":{"status":"up","timestamp":"2025-10-09T12:11:09.544855047Z"}}}
----
+
If health checks are enabled, and you want them to be exposed, also allow the health check port:
+
[source,bash]
----
firewall-cmd --zone=public --add-port=8080/tcp --permanent
firewall-cmd --reload
----