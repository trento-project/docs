include::product-attributes.adoc[]

[[sec-trento-mcp-install]]
:revdate: 2025-10-31
== Installing Trento Server MCP Component

The {trento} MCP Server can be deployed in several ways depending on your infrastructure and requirements. This guide covers three main deployment methods: Kubernetes (using Helm charts), systemd (using RPM packages), and containerized deployment (using Docker/Podman).

=== Prerequisites MCP Server

Before installing the {trento} MCP Server, ensure you have, both components must be running and be accessible for the MCP Server to function properly.

* Network connectivity between the MCP Server and {trserver} components.
* Access to the {trserver} URL (especially important when deployed behind NGINX or other reverse proxies).

// === Configuration Overview
// 
// The {trento} MCP Server requires minimal configuration, but needs to know how to reach your {trserver}. The key configuration parameters are:
// 
// * `TRENTO_URL`: The URL where your {trserver} is accessible. This is particularly important when {trento} is deployed behind NGINX or other reverse proxies. Use the externally accessible URL (e.g., `https://trento.example.com`) rather than internal service URLs. When set, the server will use this URL for OpenAPI specification autodiscovery.
// 
// * `OAS_PATH`: Explicit paths to OpenAPI specification files. Use this when you want to directly specify the location of the API specifications instead of relying on autodiscovery. This is particularly useful when you want to connect to internal services (such as `localhost` or Kubernetes service names) instead of going through a reverse proxy.
// 
// The {trento} MCP Server can be installed as part of the {trserver} deployment or as a separate component. Refer to the specific deployment method sections above for installation instructions:
// 
// * <<sec-trento-k8s-deployment>> - Kubernetes deployment with Helm
// * <<sec-systemd-deployment>> - systemd deployment with RPM packages
// * <<sec-container-deployment>> - Container deployment with Docker/Podman

=== Kubernetes MCP deployment

[[sec-trento-mcp-server-k8s]]
==== Installing {trento} MCP Server (Optional)

The {trento} MCP Server provides AI-assisted management capabilities for your SAP landscape by exposing {trento} functionality through the Model Context Protocol (MCP). This optional component enables integration with AI tools and assistants.

[NOTE]
====
The {trento} MCP Server is an optional component. The core {trserver} functionality works independently without it.

After installation, see <<sec-trento-using-mcp-server>> for instructions on how to connect MCP-compatible AI assistants and tools to your Trento Server.
====

===== Prerequisites

Before installing the {trento} MCP Server, ensure you have:

* A running {trserver} installation (Web and Wanda components).
+
The Trento Server consists of multiple components:
+
** *Web component*: Provides the user interface and API endpoints for managing SAP systems
** *Wanda component*: Handles automated checks and compliance validation for SAP landscapes
+
Both components must be running and accessible for the MCP Server to function properly.

* Network connectivity between the MCP Server and Trento Server components.
* Access to the Trento Server URL (especially important when deployed behind NGINX or other reverse proxies).

===== Configuration Overview

The {trento} MCP Server requires minimal configuration, but needs to know how to reach your Trento Server. The key configuration parameters are:

* `TRENTO_URL`: The URL where your Trento Server is accessible. This is particularly important when Trento is deployed behind NGINX or other reverse proxies. Use the externally accessible URL (e.g., `https://trento.example.com`) rather than internal service URLs. When set, the server will use this URL for OpenAPI specification autodiscovery.

* `OAS_PATH`: Explicit paths to OpenAPI specification files. Use this when you want to directly specify the location of the API specifications instead of relying on autodiscovery. This is particularly useful when you want to connect to internal services (such as `localhost` or Kubernetes service names) instead of going through a reverse proxy.

===== Enabling the MCP Server

When installing the complete {trserver} using Helm, the MCP Server is disabled by default. Enable it by passing `--set trento-mcp-server.enabled=true`:

====
[source,bash]
----
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --set trento-web.trentoWebOrigin=TRENTO_SERVER_HOSTNAME \
  --set trento-web.adminUser.password=ADMIN_PASSWORD \
  --set trento-mcp-server.enabled=true
----
====

[NOTE]
====
The examples in this guide do not specify a Kubernetes namespace for simplicity. By default, Helm will install to the `default` namespace. For production deployments, create and use a dedicated namespace:

[source,bash]
----
kubectl create namespace trento
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --namespace trento \
  --set trento-mcp-server.enabled=true \
  ...
----
====

The MCP Server will automatically connect to the {tr_web} and Wanda internal services within the {k8s} cluster.

===== MCP Server Configuration Options

The {trento} MCP Server Helm chart supports various configuration options:

====== Customize Ingress Path

By default, ingress is enabled. To customize the ingress configuration:

====
[source,bash]
----
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --set trento-mcp-server.enabled=true \
  --set trento-mcp-server.ingress.enabled=true \
  --set trento-mcp-server.ingress.hosts[0].host=TRENTO_SERVER_HOSTNAME \
  --set trento-mcp-server.ingress.hosts[0].paths[0].path=/mcp-server-trento \
  --set trento-mcp-server.ingress.hosts[0].paths[0].pathType=ImplementationSpecific
----
====

The MCP Server endpoint will be: `https://TRENTO_SERVER_HOSTNAME/mcp-server-trento/mcp`

====== Disabling Tag Filtering

By default, only operations tagged with `MCP` are exposed. To expose all operations and remove tag filtering:

====
[source,bash]
----
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --set trento-mcp-server.enabled=true \
  --set trento-mcp-server.mcpServer.tagFilter=[]
----
====

[NOTE]
====
You can also filter by different tags by setting `--set trento-mcp-server.mcpServer.tagFilter[0]=YourTag`.
====

====== Adjust Log Verbosity

The default log level is `info`. Adjust it for debugging:

====
[source,bash]
----
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --set trento-mcp-server.enabled=true \
  --set trento-mcp-server.mcpServer.verbosity=debug
----
====

====== Adjust Resource Limits

For production deployments with different resource requirements:

====
[source,bash]
----
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --set trento-mcp-server.enabled=true \
  --set trento-mcp-server.resources.requests.cpu=100m \
  --set trento-mcp-server.resources.requests.memory=128Mi \
  --set trento-mcp-server.resources.limits.cpu=1000m \
  --set trento-mcp-server.resources.limits.memory=1Gi
----
====

====== Disabling Health Check Probes

Health check probes are enabled by default. To disable them if needed:

====
[source,bash]
----
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --set trento-mcp-server.enabled=true \
  --set trento-mcp-server.livenessProbe.enabled=false \
  --set trento-mcp-server.readinessProbe.enabled=false
----
====

====== Complete Configuration Example

Here is a complete example that configures external access via a custom ingress path:

====
[source,bash]
----
helm upgrade --install trento-server oci://registry.suse.com/trento/trento-server \
  --set trento-web.trentoWebOrigin=https://trento.example.com \
  --set trento-web.adminUser.password=SecurePassword123 \
  --set trento-mcp-server.enabled=true \
  --set trento-mcp-server.mcpServer.trentoURL=https://trento.example.com \
  --set trento-mcp-server.ingress.hosts[0].host=trento.example.com \
  --set trento-mcp-server.ingress.hosts[0].paths[0].path=/mcp-server-trento \
  --set trento-mcp-server.ingress.hosts[0].paths[0].pathType=ImplementationSpecific
----
====

===== Verifying the MCP Server Installation

. Check that the MCP Server pod is running:
+
====
[source,bash]
----
kubectl get pods -l app.kubernetes.io/name=mcp-server
----
====
+
Expected output:
+
====
[source,bash]
----
NAME                                       READY   STATUS    RESTARTS   AGE
trento-server-mcp-server-xxxxxxxxxx-xxxxx  1/1     Running   0          2m
----
====
+
. Check the logs:
+
====
[source,bash]
----
kubectl logs -l app.kubernetes.io/name=mcp-server
----
====
+
. If health checks are enabled, verify the health endpoints:
+
====
[source,bash]
----
# Expose the health check port from the Pod, as it is not exposed as a Kubernetes Service.
kubectl port-forward --namespace default $(kubectl get pods --namespace default -l app.kubernetes.io/name=mcp-server -o jsonpath="{.items[0].metadata.name}") 8080:8080

# Liveness endpoint:
curl http://localhost:8080/livez

# Example output:
# {"info":{"name":"trento-mcp-server","version":"0.1.0"},"status":"up"}

# Readiness endpoint:
curl http://localhost:8080/readyz

# Example output:
# {"status":"up","details":{"mcp-server":{"status":"up","timestamp":"2025-10-09T12:11:09.528898849Z"},"wanda-api":{"status":"up","timestamp":"2025-10-09T12:11:09.544855047Z"},"web-api":{"status":"up","timestamp":"2025-10-09T12:11:09.544855047Z"}}}
----
====


=== systemd MCP deployment 

[[sec-trento-mcp-server-systemd]]
==== Installing {trento} MCP Server (Optional)

The {trento} MCP Server provides AI-assisted management capabilities for your SAP landscape by exposing {trento} functionality through the Model Context Protocol (MCP). This optional component enables integration with AI tools and assistants.

[NOTE]
====
The {trento} MCP Server is an optional component. The core {trserver} functionality works independently without it.

After installation, see <<sec-trento-using-mcp-server>> for instructions on how to connect MCP-compatible AI assistants and tools to your Trento Server.
====

===== Requirements

* {sles4sap} 15 SP3 or later.
* A running {trserver} installation (accessible via network).
* Root or sudo access for installation.

===== Configuration Overview

The {trento} MCP Server requires minimal configuration, but needs to know how to reach your Trento Server. The key configuration parameters are:

* `TRENTO_URL`: The URL where your Trento Server is accessible. This is particularly important when Trento is deployed behind NGINX or other reverse proxies. Use the externally accessible URL (e.g., `https://trento.example.com`) rather than internal service URLs. When set, the server will use this URL for OpenAPI specification autodiscovery.

* `OAS_PATH`: Explicit paths to OpenAPI specification files. Use this when you want to directly specify the location of the API specifications instead of relying on autodiscovery. This is particularly useful when you want to connect to internal services (such as `localhost` or Kubernetes service names) instead of going through a reverse proxy.

===== Installation Steps

. Install the MCP Server package:
+
====
[source,bash]
----
zypper install mcp-server-trento
----
====
+
. Create the configuration file at `/etc/trento/mcp-server-trento`:
+
====
[source,bash]
----
cp /etc/trento/mcp-server-trento.example /etc/trento/mcp-server-trento
----
====
+
. Edit the configuration file to point to your {trserver}:
+
====
[source,bash]
----
nano /etc/trento/mcp-server-trento
----
====
+
Configure the connection to your {trserver}. There are two approaches:
+
====
.TRENTO_URL approach (Recommended for most deployments)
[source,env]
----
## Set this to your Trento Server's external/public URL
## Use this when Trento is behind a reverse proxy (like NGINX) or when accessing from outside the local network
TRENTO_URL=https://trento.example.com
PORT=5000
----

.OAS_PATH approach (For direct internal connections)
[source,env]
----
## Use this when connecting directly to Trento components without going through a reverse proxy
## Useful when MCP Server runs on the same network as Trento components
OAS_PATH=http://localhost:4000/api/all/openapi,http://localhost:4001/wanda/api/all/openapi
PORT=5000
----
====
+
[NOTE]
====
**When to use TRENTO_URL:**
* Trento Server is deployed behind a reverse proxy (NGINX, etc.).
* MCP Server runs on a different host/network than Trento.
* You want to use external/public URLs.

**When to use OAS_PATH:**
* MCP Server runs on the same host as Trento components.
* You want to connect directly to internal services.
* You need to bypass reverse proxy configurations.

The TRENTO_URL approach is recommended for most production deployments.
====
+
[NOTE]
====
The MCP Server's health check HTTP server is primarily intended for Kubernetes environments, where liveness/readiness probes use it. Outside Kubernetes, you can leave it disabled. If you choose to enable it, set `ENABLE_HEALTH_CHECK=true` and `HEALTH_PORT=8080` (or your preferred port) and ensure the port is accessible (see the Firewall Configuration section below).
====
+
. Enable and start the MCP Server service:
+
====
[source,bash]
----
systemctl enable --now mcp-server-trento
systemctl start mcp-server-trento
----
====
+
. Verify the service is running:
+
====
[source,bash]
----
systemctl status mcp-server-trento
----
====
+
Expected output:
+
====
[source,bash]
----
‚óè mcp-server-trento.service - Trento MCP Server service
     Loaded: loaded (/usr/lib/systemd/system/mcp-server-trento.service; enabled)
     Active: active (running) since ...
----
====
+
. Check the service logs:
+
====
[source,bash]
----
journalctl -u mcp-server-trento -f
----
====
+
. The Trento MCP Server should be listening at `http://localhost:5000/mcp` (or `http://localhost:<PORT>/mcp` if you changed the `PORT` setting). If you need remote access, ensure this port is open in your firewall; see <<sec-mcp-systemd-firewall>>.
+
. If you enabled health checks, verify the endpoints locally:

====
[source,bash]
----
# Note: Replace localhost with the server's IP/hostname if running these commands from a remote machine, and ensure the health port is allowed by your firewall.

# Liveness endpoint:
curl http://localhost:8080/livez

# Example output:
# {"info":{"name":"trento-mcp-server","version":"0.1.0"},"status":"up"}

# Readiness endpoint:
curl http://localhost:8080/readyz

# Example output:
# {"status":"up","details":{"mcp-server":{"status":"up","timestamp":"2025-10-09T12:11:09.528898849Z"},"wanda-api":{"status":"up","timestamp":"2025-10-09T12:11:09.542078327Z"},"web-api":{"status":"up","timestamp":"2025-10-09T12:11:09.544855047Z"}}}
----
====

[[sec-mcp-systemd-firewall]]
===== Firewall Configuration

If firewalld is running, allow incoming connections to the MCP Server port:

====
[source,bash]
----
firewall-cmd --zone=public --add-port=5000/tcp --permanent
firewall-cmd --reload
----
====

If health checks are enabled, and you want them to be exposed, also allow the health check port:

====
[source,bash]
----
firewall-cmd --zone=public --add-port=8080/tcp --permanent
firewall-cmd --reload
----
====

[NOTE]
====
Use the ports you configured. Replace the example values `5000` and `8080` with your actual settings:

- `PORT`: MCP Server listening port (default: 5000).
- `HEALTH_PORT`: Health check server port (default: 8080).

Adjust all commands and firewall rules accordingly.
====