= Components Navigation Generator – Contribution Guidelines

== Overview

This script is part of the Trento Antora documentation build process.  
Its role is to **automatically generate the `Components` section navigation** (`nav_components.adoc`) by scanning multiple upstream repositories cloned during the build.

All content changes should happen **in the respective upstream repositories** (e.g., `trento-project/agent`, `trento-project/web`, etc.).  
The script simply **reflects** those changes into the Antora site during the CI build.

== Why we need rules

Since the navigation is automatically built, **consistent directory and file structure is critical**.  
We must define rules so that:

* Documentation is discoverable
* The navigation is clean and predictable
* Unwanted folders (e.g., assets, examples) are excluded
* Titles are human-friendly and based on document headers

== Folders and files ignored

The script ignores certain folders inside documentation directories:

[source,js]
----
ignoredDirs: ['image', 'images', 'examples']
----

That means any directory named `image`, `images`, or `examples` (case-insensitive) is **skipped**.  
They will not appear in the navigation.

== Recognized documentation folders

Inside each upstream component repository, the following folders are scanned for `.adoc` files:

[source,js]
----
docsDirNames: ['docs', 'guides']
----

If a component does not have these folders, it will still be listed if it has a `README.adoc`.

== README handling

Each component must have a `README.adoc` at its root.  
This acts as the entry point in the navigation for that component.

Example:
----
*** xref:ROOT:agent:README.adoc[Trento Agent]
----

The `README.adoc`'s first-level AsciiDoc title (`= My Title`) is used as the link text.

=== Subdirectory README files

The script supports `README.adoc` files in subdirectories within `docs/` or `guides/`.
When a subdirectory contains a `README.adoc` file, the directory name becomes a clickable link to that README.

Example:
----
**** xref:ROOT:mcp-server:Developer/README.adoc[Developer]
**** xref:ROOT:mcp-server:Trento MCP Server documentation/README.adoc[Trento MCP Server documentation]
----

This creates a more organized navigation where subdirectories with README files provide contextual documentation for their contents, while the directory name remains clear for navigation purposes.

== Cross-platform compatibility (GitHub + Antora)

To ensure documentation works seamlessly on both GitHub and Antora, follow these conditional formatting patterns:

=== File path prefixes

In root README files, use conditional prefixes to ensure proper navigation:

[source,adoc]
----
ifndef::site-gen-antora[:relfileprefix: docs/]
ifndef::site-gen-antora[:relfileprefix: guides/]
----

This ensures links work correctly in both GitHub (which needs the path prefix) and Antora (which doesn't).

=== Image handling

For images, use the conditional imagesdir attribute:

[source,adoc]
----
ifndef::imagesdir[:imagesdir: ../images]
----

Store all images in the `docs/images/` or `guides/images/` directory of your component. Reference them like this:

[source,adoc]
----
image::trento-spa-refresh.png[Refresh token success diagram]

.Refresh token failure diagram
image::trento-spa-refresh-failed.png[Refresh token failure diagram]
----

The Antora collector automatically scans image directories and places them correctly:

[source,yaml]
----
- dir: trento-docs-site/build/tmp_components/web/guides/images
  files: '**/*.{png,jpg,jpeg,svg,gif}'
  into: modules/web/images/
----

=== Cross-references (Root README only)

When linking from the root README to other files in the same component root, use conditional syntax:

[source,adoc]
----
ifdef::site-gen-antora[]
See xref:CONTRIBUTING.adoc[contribution guidelines].
endif::[]
ifndef::site-gen-antora[]
See link:CONTRIBUTING.adoc[contribution guidelines].
endif::[]
----

This ensures proper xref resolution in Antora while maintaining GitHub compatibility. This pattern is only needed in root README files when linking to other root-level files.

== Title extraction

The script reads the first-level title in each `.adoc` file:

[source,js]
----
REGEX.contentTitle: /^=\s*(.+)/m
----

If no title is found, the file name (without extension) is used.

The script **removes the `=`** when building navigation, so:

----
= How to release a new version of Trento Agent
----

becomes:

----
***** xref:ROOT:agent:development/how-to-make-a-release.adoc[How to release a new version of Trento Agent]
----

== Navigation structure

* Components are listed under a `** Components` section.
* Each component appears at level 3 (`***`) in the nav.
* Its `docs/` and `guides/` contents appear as level 4+ entries (`****`, `*****`, etc.).

Example output:

----
** Components

*** xref:ROOT:agent:README.adoc[Trento Agent]
**** xref:ROOT:agent:ci-cd-variables.adoc[CI/CD Variables expected by Trento GH Action Runner]
**** development
***** xref:ROOT:agent:development/how-to-make-a-release.adoc[How to release a new version of Trento Agent]
----

== Process flow

. The CI pipeline clones all upstream repos into `trento-docs-site/build/tmp_components`.
. The script (`trento-docs-site/scripts/generate-components.nav.js`):
.. Creates the output directory `trento-docs-site/build/gen_navigation` if it doesn't exist.
.. Reads the list of component directories from `tmp_components`.
.. For each component:
... Checks for a root `README.adoc` file (components without README are skipped).
... Extracts the title from README using regex `/^=\s*(.+)/m`.
... Adds the README to navigation as a level 3 entry (`***`).
... Scans `docs/` and `guides/` directories for `.adoc` files.
... Ignores directories named `image`, `images`, or `examples` (case-insensitive).
... For each `.adoc` file found:
.... Extracts title from first-level AsciiDoc header or uses filename as fallback.
.... Creates xref links with format `xref:ROOT:componentName:filePath[title]`.
.... Handles nested directories by creating appropriate navigation levels.
... Skips any README files found inside `docs/` or `guides/` directories.
.. Builds the final navigation content starting with `** Components` header.
. Writes the generated navigation to `trento-docs-site/build/gen_navigation/nav_components.adoc`.
. Prints a comprehensive summary log showing:
.. Number of processed components with their names.
.. Complete generated navigation content.
.. Output file path confirmation.

== Summary

If you contribute documentation to any Trento upstream repository:

* **Always** add or update the `README.adoc` at the root for that component.
* Place `.adoc` documentation in `docs/` or `guides/`.
* Do **not** put `.adoc` files inside `images/`, `image/`, or `examples/` folders (they are ignored).
* Use proper first-level titles in `.adoc` files (`= My Title`).
* **Follow cross-platform compatibility patterns**:
** Use `ifndef::site-gen-antora[:relfileprefix: docs/]` or `guides/` in root README files.
** Use `ifndef::imagesdir[:imagesdir: ../images]` for image directories.
** Store images in `docs/images/` or `guides/images/` directories.
** Use conditional xref/link syntax in root README when linking to root-level files.
* Remember: The script runs automatically during CI — the nav file is never edited manually.