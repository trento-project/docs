= Components Navigation Generator – Contribution Guidelines

== Overview

This script is part of the Trento Antora documentation build process.  
Its role is to **automatically generate the `Components` section navigation** (`nav_components.adoc`) by scanning multiple upstream repositories cloned during the build.

All content changes should happen **in the respective upstream repositories** (e.g., `trento-project/agent`, `trento-project/web`, etc.).  
The script simply **reflects** those changes into the Antora site during the CI build.

== Why we need rules

Since the navigation is automatically built, **consistent directory and file structure is critical**.  
We must define rules so that:

* Documentation is discoverable
* The navigation is clean and predictable
* Unwanted folders (e.g., assets, examples) are excluded
* Titles are human-friendly and based on document headers

== Folders and files ignored

The script ignores certain folders inside documentation directories:

[source,js]
----
ignoredDirs: ['image', 'images', 'examples']
----

That means any directory named `image`, `images`, or `examples` (case-insensitive) is **skipped**.  
They will not appear in the navigation.

== Recognized documentation folders

Inside each upstream component repository, the following folders are scanned for `.adoc` files:

[source,js]
----
docsDirNames: ['docs', 'guides']
----

If a component does not have these folders, it will still be listed if it has a `README.adoc`.

== README handling

Each component must have a `README.adoc` at its root.  
This acts as the entry point in the navigation for that component.

Example:
----
*** xref:ROOT:agent:README.adoc[Trento Agent]
----

The `README.adoc`'s first-level AsciiDoc title (`= My Title`) is used as the link text.

> NOTE: README files inside `docs` or `guides` are ignored to avoid conflicts with Antora’s navigation and xref resolution. Only the root README must be used.

== Title extraction

The script reads the first-level title in each `.adoc` file:

[source,js]
----
REGEX.contentTitle: /^=\s*(.+)/m
----

If no title is found, the file name (without extension) is used.

The script **removes the `=`** when building navigation, so:

----
= How to release a new version of Trento Agent
----

becomes:

----
***** xref:ROOT:agent:development/how-to-make-a-release.adoc[How to release a new version of Trento Agent]
----

== Navigation structure

* Components are listed under a `** Components` section.
* Each component appears at level 3 (`***`) in the nav.
* Its `docs/` and `guides/` contents appear as level 4+ entries (`****`, `*****`, etc.).

Example output:

----
** Components

*** xref:ROOT:agent:README.adoc[Trento Agent]
**** xref:ROOT:agent:ci-cd-variables.adoc[CI/CD Variables expected by Trento GH Action Runner]
**** development
***** xref:ROOT:agent:development/how-to-make-a-release.adoc[How to release a new version of Trento Agent]
----

== Process flow

. The CI pipeline clones all upstream repos into `trento-docs-site/build/tmp_components`.
. The script:
.. Reads the list of component directories.
.. For each component:
... Adds its `README.adoc` to navigation.
... Scans `docs/` and `guides/` for `.adoc` files, ignoring `images` and `examples` directories.
... Extracts human-friendly titles.
... Builds `xref:` links.
. Writes the generated nav to `trento-docs-site/build/gen_navigation/nav_components.adoc`.
. Prints a summary log with:
.. Number of processed components
.. List of component names
.. Generated navigation content
.. Output file path

== Summary

If you contribute documentation to any Trento upstream repository:

* **Always** add or update the `README.adoc` at the root for that component.
* Place `.adoc` documentation in `docs/` or `guides/`.
* Do **not** put `.adoc` files inside `images/`, `image/`, or `examples/` folders (they are ignored).
* Use proper first-level titles in `.adoc` files (`= My Title`).
* Remember: The script runs automatically during CI — the nav file is never edited manually.